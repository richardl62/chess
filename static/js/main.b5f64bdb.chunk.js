(this.webpackJsonpchess=this.webpackJsonpchess||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(23),i=n.n(r),c=n(3),s=n(4),l=n(14),u=n(12),d=n(39),h=n(27),f=n(24),p=n(28),m=function(){function e(t,n){if(Object(c.a)(this,e),this._corePieces=void 0,this._topLeftBlack=void 0,!(t instanceof Array&&"boolean"===typeof n))throw new Error("Bad input to BoardLayout");this._corePieces=t,this._topLeftBlack=n,Object.seal(this)}return Object(s.a)(e,[{key:"copy",value:function(){return new e(this._corePieces.map((function(e){return Object(p.a)(e)})),this._topLeftBlack)}},{key:"corePiece",value:function(e){function t(t,n,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){if(void 0===this._corePieces[e][t])throw new Error("Invalid row or column number: ".concat(e," ").concat(t));return void 0!==n&&(this._corePieces[e][t]=n),this._corePieces[e][t]}))},{key:"isBlack",value:function(e,t){return(e+t)%2===0?this._topLeftBlack:!this._topLeftBlack}},{key:"findCorePiecebyId",value:function(e){for(var t=0;t<this.nRows;++t)for(var n=0;n<this.nCols;++n){var a=this._corePieces[t][n];if(a&&a.id===e)return{row:t,col:n,piece:a}}return null}},{key:"clearSquares",value:function(){var e,t=Object(f.a)(this._corePieces);try{for(t.s();!(e=t.n()).done;){e.value.fill(null)}}catch(n){t.e(n)}finally{t.f()}return this}},{key:"reserveRows",value:function(){this._topLeftBlack=this.isBlack(this.nRows-1,0);for(var e=this._corePieces,t=0;t<this.nRows/2;++t)for(var n=this.nRows-(t+1),a=0;a<this.nCols;++a){var o=e[t][a];e[t][a]=e[n][a],e[n][a]=o}return this}},{key:"nRows",get:function(){return this._corePieces.length}},{key:"nCols",get:function(){return this._corePieces[0].length}}]),e}(),y=n(13),v=n(41),b="piece",k=n(40),g=n(25),P=n.n(g);function w(e){var t=e.corePiece,n=e.gameOptions,a=Object(k.a)({item:{type:b,id:t.id},collect:function(e){return{isDragging:!!e.isDragging()}},end:function(e,a){return n.dragEnd(t.id,a.didDrop())}}),r=Object(y.a)(a,2),i=r[0].isDragging,c=r[1];return i&&n.dragBehaviour(t.id).move?null:o.a.createElement("div",{className:"piece-div",ref:c},o.a.createElement(P.a,{piece:t.name}))}var _=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props,t=e.color,n=e.children,a="square";if(t)if("black"===t)a+=" black-square";else{if("white"!==t)throw new Error("Unrecognised square color: ".concat(t));a+=" white-square"}return o.a.createElement("div",{className:"square-placeholder"},o.a.createElement("div",{className:a},n))}}]),n}(o.a.PureComponent);function E(e){var t=e.corePiece,n=e.gameOptions,a=e.color,r=e.row,i=e.col,c=Object(v.a)({accept:b,drop:function(e){return n.movePiece(e.id,r,i)},collect:function(e){return{isOver:!!e.isOver()}}}),s=Object(y.a)(c,2)[1];return o.a.createElement("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"}},o.a.createElement(_,{color:a},t?o.a.createElement(w,{corePiece:t,gameOptions:n}):null))}function O(e,t,n){var a=function(e){return n+"-"+e};t.push(o.a.createElement("div",{key:a("start")}));for(var r=0;r<e;++r)t.push(o.a.createElement("div",{key:a(r),className:"board-boarder board-boarder-letter"},String.fromCharCode(65+r)));t.push(o.a.createElement("div",{key:a("end")}))}function S(e,t,n,a){var r=function(e){return"r"+t+"-"+e},i=function(a){return o.a.createElement("div",{key:r(a),className:"board-boarder board-boarder-number"},n.numberRowsFromTop?t+1:e.nRows-t)},c=function(a){return o.a.createElement(E,{index:a,key:r(a),corePiece:e.corePiece(t,a),gameOptions:n,color:e.isBlack(t,a)?"black":"white",row:t,col:a})};a.push(i("start"));for(var s=0;s<e.nCols;++s)a.push(c(s));a.push(i("end"))}function B(e){var t=e.layout,n=e.gameOptions,a=t.nRows,r=t.nCols,i=[];O(r,i,"top");for(var c=0;c<a;++c)S(t,c,n,i);O(r,i,"bottom");var s={display:"grid",gridTemplateColumns:"repeat(".concat(r+2,",auto)"),gridTemplateRows:"repeat(".concat(a+2,",auto)")};return o.a.createElement("div",{className:"board",style:s},i)}var C=function e(t,n){Object(c.a)(this,e),this.name=void 0,this.id=void 0,this.id=n,this.name=t,Object.freeze(this)},j=function(){function e(){Object(c.a)(this,e),this._lastUsedId=void 0,this._lastUsedId=0}return Object(s.a)(e,[{key:"make",value:function(e){return null===e?null:(++this._lastUsedId,new C(e,this._lastUsedId))}},{key:"copy",value:function(e){return this.make(e.name)}}]),e}(),R={standard:{copyableTop:["p","n","b","r","q","k"],board:[["r","n","b","q","k","b","n","r"],["p","p","p","p","p","p","p","p"],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],["P","P","P","P","P","P","P","P"],["R","N","B","Q","K","B","N","R"]],topLeftBlack:!1,copyableBottom:["P","N","B","R","Q","K"],displayName:"Standard"},fiveASide:{copyableTop:["p","n","b","r","q","k"],board:[["r","n","b","q","k"],["p","p","p","p","p"],[null,null,null,null,null],[null,null,null,null,null],["P","P","P","P","P"],["R","N","B","Q","K"]],topLeftBlack:!1,copyableBottom:["P","N","B","R","Q","K"],displayName:"5-a-side"}},L=Object.keys(R);var N=function(e){var t=e.gameOptions,n=t.boardLayout();return o.a.createElement("div",{className:"game-control"},o.a.createElement("div",{className:"game-type"},L.map((function(e){return o.a.createElement("div",{key:e},o.a.createElement("input",{type:"radio",name:"game-type",id:e,onChange:function(){return t.boardLayout(e)},checked:n===e}),o.a.createElement("label",{htmlFor:e,name:"game-type"},R[e].displayName.replace("o","&#8209;")))}))),o.a.createElement("div",{className:"buttons"},o.a.createElement("button",{type:"button",onClick:function(){return t.clear()}}," Clear"),o.a.createElement("button",{type:"button",onClick:function(){return t.flip()}},"Flip")),o.a.createElement("div",{className:"buttons"},o.a.createElement("button",{type:"undo",disabled:!t.canUndo,onClick:function(){return t.undo()}},"Undo"),o.a.createElement("button",{type:"redo",disabled:!t.canRedo,onClick:function(){return t.redo()}},"Redo"),o.a.createElement("button",{type:"button",onClick:function(){return t.restart()}},"Restart")))},I=n(20);function F(e,t){return Object.keys(e).length!==Object.keys(t).length?(console.log("States have different keys",Object.keys(e),Object.keys(t)),!1):function(e,t){for(var n in e)if(e[n]!==t[n])return console.log("sub[".concat(n,"] !== full[").concat(n,"]"),e[n],t[n]),!1;return!0}(e,t)}var T=function(){function e(t){Object(c.a)(this,e),this._states=void 0,this._stateIndex=void 0,this._clientFunctions=void 0,this._states=[t.getState()],this._stateIndex=0,this._clientFunctions=t}return Object(s.a)(e,[{key:"sanityCheck",value:function(){var e=this._clientFunctions.getState();if(!F(this.state,e))throw console.log("this.state",this.state,"clientState",e),new Error("StateManager out of sync with client")}},{key:"_setClientState",value:function(){this._clientFunctions.setState(this.state)}},{key:"undo",value:function(){this.sanityCheck();var e=this.canUndo;return e&&(--this._stateIndex,this._setClientState()),e}},{key:"redo",value:function(){this.sanityCheck();var e=this.canRedo;return e&&(++this._stateIndex,this._setClientState()),e}},{key:"restart",value:function(){this.sanityCheck(),0!==this._stateIndex&&(this._stateIndex=0,this._setClientState())}},{key:"setState",value:function(e){this.sanityCheck();var t=Object(I.a)(Object(I.a)({},this.state),e);if(this._states=this._states.slice(0,this._stateIndex+1),this._states.push(t),++this._stateIndex,this.state!==t)throw new Error("internal error in StateManager.setState");this._setClientState()}},{key:"canUndo",get:function(){return this._stateIndex>0}},{key:"canRedo",get:function(){return this._stateIndex+1<this._states.length}},{key:"state",get:function(){return this._states[this._stateIndex]}}]),e}();function M(e){var t=e.corePieces,n=e.gameOptions;return o.a.createElement("div",{className:"row-of-pieces"},t.map((function(e,t){return o.a.createElement(_,{key:t},o.a.createElement(w,{corePiece:e,gameOptions:n}))})))}function x(e,t){var n=function(e){return t.make(e)},a=R[e];if(!a)throw new Error("Unrecognised layout name: ".concat(e));var o=a.board.map((function(e){return e.map(n)}));return{copyablePiecesTop:a.copyableTop.map(n),boardLayout:new m(o,a.topLeftBlack),copyablePiecesBottom:a.copyableBottom.map(n),layoutName:e}}var U=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n),e=t.call(this);var a=new j;return e._corePieceFactory=a,e.state=x("standard",a),e.state.numberRowsFromTop=!1,e.stateManager=new T({getState:function(){return e.state},setState:function(t){return e.setState(t)}}),e}return Object(s.a)(n,[{key:"doSetState",value:function(e){this.stateManager.setState(e)}},{key:"undo",value:function(){return this.stateManager.undo()}},{key:"redo",value:function(){return this.stateManager.redo()}},{key:"restart",value:function(){this.stateManager.restart()}},{key:"componentDidMount",value:function(){document.title="Chess"}},{key:"boardLayout",value:function(e){return void 0!==e&&this.doSetState(x(e,this._corePieceFactory)),this.state.layoutName}},{key:"clear",value:function(){this.doSetState({boardLayout:this.state.boardLayout.copy().clearSquares()})}},{key:"flip",value:function(){this.doSetState({boardLayout:this.state.boardLayout.copy().reserveRows(),copyablePiecesTop:this.state.copyablePiecesBottom,copyablePiecesBottom:this.state.copyablePiecesTop,numberRowsFromTop:!this.state.numberRowsFromTop})}},{key:"_findOffBoardPiece",value:function(e){var t=this.state.copyablePiecesTop.find((function(t){return t.id===e}));return t||(t=this.state.copyablePiecesBottom.find((function(t){return t.id===e}))),t}},{key:"movePiece",value:function(e,t,n){var a=this,o=this.state.boardLayout.copy(),r=function(){return a.doSetState({boardLayout:o})},i=o.findCorePiecebyId(e);if(i)t===i.row&&n===i.col||(o.corePiece(t,n,i.piece),o.corePiece(i.row,i.col,null),r());else{var c=this._findOffBoardPiece(e);if(!c)throw new Error("Piece with id ".concat(e," not found"));var s=this._corePieceFactory.copy(c);o.corePiece(t,n,s),r()}}},{key:"dragEnd",value:function(e,t){if(!t){var n=this.state.boardLayout.findCorePiecebyId(e);if(n){var a=this.state.boardLayout.copy();a.corePiece(n.row,n.col,null),this.doSetState({boardLayout:a})}}}},{key:"dragBehaviour",value:function(e){var t=Boolean(this.state.boardLayout.findCorePiecebyId(e));return{move:t,copy:!t}}},{key:"renderMainGame",value:function(){return o.a.createElement(d.a,{backend:h.a},o.a.createElement("div",{className:"game"},o.a.createElement(M,{corePieces:this.state.copyablePiecesTop,gameOptions:this}),o.a.createElement(B,{layout:this.state.boardLayout,gameOptions:this}),o.a.createElement(M,{corePieces:this.state.copyablePiecesBottom,gameOptions:this})))}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.renderMainGame(),o.a.createElement(N,{gameOptions:this}))}},{key:"canUndo",get:function(){return this.stateManager.canUndo}},{key:"canRedo",get:function(){return this.stateManager.canRedo}},{key:"numberRowsFromTop",get:function(){return this.state.numberRowsFromTop}}]),n}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(36);var q=document.getElementById("root");i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(U,null)),q),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[37,1,2]]]);
//# sourceMappingURL=main.b5f64bdb.chunk.js.map